{% extends 'base.html' %}

{% block content %}
<style>
    .support-hero {
        background: linear-gradient(135deg, rgba(15, 32, 55, 0.95) 0%, rgba(21, 101, 192, 0.9) 100%);
        padding: 80px 0;
        color: white;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .support-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        pointer-events: none;
    }
    
    .support-hero h1 {
        font-size: 2.8rem;
        font-weight: 700;
        margin-bottom: 1rem;
        position: relative;
        z-index: 1;
    }
    
    .support-hero p {
        font-size: 1.2rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }
    
    .support-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        height: 100%;
        border: 2px solid transparent;
    }
    
    .support-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
        border-color: #2196F3;
    }
    
    .support-icon {
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%);
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.3);
        transition: all 0.3s ease;
    }
    
    .support-card:hover .support-icon {
        transform: scale(1.1) rotate(5deg);
    }
    
    .support-icon i {
        font-size: 1.8rem;
        color: white;
    }
    
    .support-card h4 {
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 12px;
    }
    
    .support-card p {
        color: #64748b;
        margin-bottom: 20px;
    }
    
    .support-card .btn {
        border-radius: 12px;
        padding: 12px 24px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .contact-info-box {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border-radius: 16px;
        padding: 25px;
        display: flex;
        align-items: center;
        gap: 20px;
        transition: all 0.3s ease;
    }
    
    .contact-info-box:hover {
        transform: translateX(5px);
    }
    
    .contact-info-box .icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.3rem;
        flex-shrink: 0;
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .status-badge.online {
        background: #dcfce7;
        color: #166534;
    }
    
    .status-badge.online::before {
        content: '';
        width: 8px;
        height: 8px;
        background: #22c55e;
        border-radius: 50%;
        animation: pulse-dot 2s infinite;
    }
    
    @keyframes pulse-dot {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.2); }
    }
</style>

<!-- Hero Section -->
<div class="support-hero">
    <div class="container">
        <h1 class="animate-fade-in-down" style="animation: fadeInDown 0.6s ease-out;">How can we help you?</h1>
        <p class="animate-fade-in-up" style="animation: fadeInUp 0.6s ease-out 0.2s backwards;">Get instant support for all your queries - we're here 24/7</p>
        <div class="mt-4">
            <span class="status-badge online">
                <span></span> Support Team Online
            </span>
        </div>
    </div>
</div>

<!-- Quick Support Options -->
<div class="container py-5">
    <div class="row g-4 mb-5 justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="support-card text-center">
                <div class="support-icon mx-auto">
                    <i class="bi bi-telephone"></i>
                </div>
                <h4>Call Us</h4>
                <p>Speak directly with our support team over phone.</p>
                <a href="tel:+918160868146" class="btn btn-outline-primary w-100">
                    <i class="bi bi-telephone-fill me-2"></i>+91 81608 68146
                </a>
            </div>
        </div>
        <div class="col-md-6 col-lg-4">
            <div class="support-card text-center">
                <div class="support-icon mx-auto">
                    <i class="bi bi-envelope"></i>
                </div>
                <h4>Email Support</h4>
                <p>Send us an email and we'll respond within 24 hours.</p>
                <button class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#emailModal">
                    <i class="bi bi-envelope-fill me-2"></i>Send Email
                </button>
            </div>
        </div>
        <div class="col-md-6 col-lg-4">
            <div class="support-card text-center">
                <div class="support-icon mx-auto">
                    <i class="bi bi-whatsapp"></i>
                </div>
                <h4>WhatsApp</h4>
                <p>Message us on WhatsApp for quick assistance.</p>
                <a href="https://wa.me/918160868146" target="_blank" class="btn btn-success w-100">
                    <i class="bi bi-whatsapp me-2"></i>Chat on WhatsApp
                </a>
            </div>
        </div>
    </div>
</div>






<!-- Chatbot Widget -->
<div id="chatbot-container" style="display: none;">
    <div id="chatbot-widget">
        <div id="chatbot-header">
            <div class="d-flex align-items-center">
                <div class="chatbot-avatar">
                    <i class="bi bi-robot"></i>
                </div>
                <div class="ms-2">
                    <h6 class="mb-0 text-white">Stayfinder</h6>
                    <small class="text-white-50">Online</small>
                </div>
            </div>
            <button id="chatbot-close" class="btn btn-link text-white p-0" onclick="closeLiveChat()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div id="chatbot-messages">
            <div class="chat-message bot">
                <div class="message-content">
                    üëã Hi! Welcome to Stayfinder. How can I help you today?
                </div>
            </div>
            <div class="quick-replies">
                <button class="quick-reply-btn" onclick="sendQuickReply('Find a PG/Hostel')">Find a PG/Hostel</button>
                <button class="quick-reply-btn" onclick="sendQuickReply('Booking Help')">Booking Help</button>
                <button class="quick-reply-btn" onclick="sendQuickReply('List my Property')">List my Property</button>
                <button class="quick-reply-btn" onclick="sendQuickReply('Payment Issues')">Payment Issues</button>
            </div>
        </div>
        <div id="chatbot-input">
            <input type="text" id="chat-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
            <button id="chat-send" onclick="sendMessage()">
                <i class="bi bi-send-fill"></i>
            </button>
        </div>
    </div>
</div>

<style>
    #chatbot-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
    }
    
    #chatbot-widget {
        width: 380px;
        height: 520px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    #chatbot-header {
        background: linear-gradient(135deg, #1a2a3a 0%, #2d4a5e 100%);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .chatbot-avatar {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }
    
    #chatbot-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        background: #f8f9fa;
    }
    
    .chat-message {
        margin-bottom: 15px;
        display: flex;
    }
    
    .chat-message.bot {
        justify-content: flex-start;
    }
    
    .chat-message.user {
        justify-content: flex-end;
    }
    
    .message-content {
        max-width: 80%;
        padding: 12px 16px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.5;
    }
    
    .chat-message.bot .message-content {
        background: white;
        color: #333;
        border-bottom-left-radius: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .chat-message.user .message-content {
        background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%);
        color: white;
        border-bottom-right-radius: 5px;
    }
    
    .quick-replies {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
    }
    
    .quick-reply-btn {
        background: white;
        border: 1px solid #2196F3;
        color: #2196F3;
        padding: 8px 14px;
        border-radius: 20px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .quick-reply-btn:hover {
        background: #2196F3;
        color: white;
    }
    
    #chatbot-input {
        padding: 15px;
        background: white;
        border-top: 1px solid #eee;
        display: flex;
        gap: 10px;
    }
    
    #chat-input {
        flex: 1;
        border: 1px solid #ddd;
        border-radius: 25px;
        padding: 12px 20px;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
    }
    
    #chat-input:focus {
        border-color: #2196F3;
    }
    
    #chat-send {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%);
        border: none;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    #chat-send:hover {
        transform: scale(1.05);
    }
    
    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 12px 16px;
    }
    
    .typing-indicator span {
        width: 8px;
        height: 8px;
        background: #999;
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }
    
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
        0%, 100% { opacity: 0.3; transform: translateY(0); }
        50% { opacity: 1; transform: translateY(-3px); }
    }
    
    @media (max-width: 480px) {
        #chatbot-widget {
            width: 100%;
            height: 100%;
            border-radius: 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
    }
</style>

<script>
    // Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
        // Start Chat button
        var startBtn = document.getElementById('startChatBtn');
        if (startBtn) {
            startBtn.addEventListener('click', function() {
                document.getElementById('chatbot-container').style.display = 'block';
            });
        }
        
        // Close button
        var closeBtn = document.getElementById('chatbot-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', function() {
                document.getElementById('chatbot-container').style.display = 'none';
            });
        }
    });
    
    function openLiveChat() {
        document.getElementById('chatbot-container').style.display = 'block';
    }
    
    function closeLiveChat() {
        document.getElementById('chatbot-container').style.display = 'none';
    }
    
    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendMessage();
        }
    }
    
    function sendMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        if (!message) return;
        
        addMessage(message, 'user');
        input.value = '';
        
        // Show typing indicator
        showTyping();
        
        // Get bot response
        setTimeout(() => {
            hideTyping();
            const response = getBotResponse(message);
            addMessage(response, 'bot');
        }, 1000 + Math.random() * 500);
    }
    
    function sendQuickReply(message) {
        addMessage(message, 'user');
        
        // Hide quick replies after selection
        document.querySelector('.quick-replies')?.remove();
        
        showTyping();
        setTimeout(() => {
            hideTyping();
            const response = getBotResponse(message);
            addMessage(response, 'bot');
        }, 1000);
    }
    
    function addMessage(text, sender) {
        const messagesDiv = document.getElementById('chatbot-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}`;
        messageDiv.innerHTML = `<div class="message-content">${text}</div>`;
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function showTyping() {
        const messagesDiv = document.getElementById('chatbot-messages');
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typing-indicator';
        typingDiv.className = 'chat-message bot';
        typingDiv.innerHTML = `
            <div class="message-content typing-indicator">
                <span></span><span></span><span></span>
            </div>
        `;
        messagesDiv.appendChild(typingDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    function hideTyping() {
        document.getElementById('typing-indicator')?.remove();
    }
    
    function getBotResponse(message) {
        const msg = message.toLowerCase();
        
        if (msg.includes('find') || msg.includes('pg') || msg.includes('hostel') || msg.includes('search')) {
            return "üè† To find a PG or Hostel:<br><br>1. Go to our <a href='/' style='color:#2196F3'>homepage</a><br>2. Enter your preferred city<br>3. Use filters for price, amenities & more<br><br>Need help with a specific location?";
        }
        if (msg.includes('book') || msg.includes('booking')) {
            return "üìÖ For booking help:<br><br>1. Select a property you like<br>2. Click 'Book Now' or 'Send Enquiry'<br>3. Fill in your details<br>4. You'll receive confirmation via email<br><br>Having issues with an existing booking?";
        }
        if (msg.includes('list') || msg.includes('property') || msg.includes('owner')) {
            return "üè¢ To list your property:<br><br>1. <a href='/register-owner' style='color:#2196F3'>Register as an Owner</a><br>2. Complete your profile<br>3. Add your property details & photos<br>4. Submit for verification<br><br>It's free to list!";
        }
        if (msg.includes('payment') || msg.includes('pay') || msg.includes('money')) {
            return "üí≥ For payment issues:<br><br>‚Ä¢ Payments are handled directly with property owners<br>‚Ä¢ We recommend using secure payment methods<br>‚Ä¢ Keep all payment receipts<br><br>For specific payment disputes, please email us at stayfinder101@gmail.com";
        }
        if (msg.includes('contact') || msg.includes('call') || msg.includes('phone')) {
            return "üìû Contact us:<br><br>‚Ä¢ Phone: +91 8160868146<br>‚Ä¢ Email: stayfinder101@gmail.com<br>‚Ä¢ WhatsApp: +91 8160868146<br><br>We're available Mon-Sat, 9AM-8PM";
        }
        if (msg.includes('hello') || msg.includes('hi') || msg.includes('hey')) {
            return "Hello! üëã How can I assist you today? I can help with finding PGs, booking help, listing properties, or any other queries.";
        }
        if (msg.includes('thank')) {
            return "You're welcome! üòä Is there anything else I can help you with?";
        }
        if (msg.includes('bye') || msg.includes('goodbye')) {
            return "Goodbye! üëã Thanks for chatting with Stayfinder. Have a great day!";
        }
        
        return "I understand you're asking about: \"" + message + "\"<br><br>For detailed assistance, you can:<br>‚Ä¢ Call us: +91 8160868146<br>‚Ä¢ Email: stayfinder101@gmail.com<br>‚Ä¢ <a href='https://wa.me/918160868146' style='color:#2196F3'>WhatsApp us</a><br><br>Is there something specific I can help with?";
    }
</script>

<!-- Email Modal -->
<div class="modal fade" id="emailModal" tabindex="-1" aria-labelledby="emailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #2196F3 0%, #1976d2 100%); color: white;">
                <h5 class="modal-title" id="emailModalLabel">
                    <i class="bi bi-envelope-fill me-2"></i>Send us an Email
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <form method="POST" action="{{ url_for('send_contact_email') }}" id="emailForm">
                    <div class="mb-3">
                        <label for="emailName" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="emailName" name="name" placeholder="Enter your full name" required>
                    </div>
                    <div class="mb-3">
                        <label for="emailAddress" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="emailAddress" name="email" placeholder="you@example.com" required>
                    </div>
                    <div class="mb-3">
                        <label for="emailPhone" class="form-label">Phone (Optional)</label>
                        <input type="text" class="form-control" id="emailPhone" name="phone" placeholder="+91 98765 43210">
                    </div>
                    <div class="mb-3">
                        <label for="emailTopic" class="form-label">Topic</label>
                        <select class="form-select" id="emailTopic" name="topic" required>
                            <option value="">Select a topic</option>
                            <option value="Booking support">Booking support</option>
                            <option value="List my property">List my property</option>
                            <option value="Partnerships">Partnerships</option>
                            <option value="Billing & payments">Billing & payments</option>
                            <option value="General inquiry">General inquiry</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="emailMessage" class="form-label">Message</label>
                        <textarea class="form-control" id="emailMessage" name="message" rows="5" placeholder="Please describe your issue or inquiry..." required></textarea>
                    </div>
                    <div class="alert alert-info" role="alert">
                        <i class="bi bi-info-circle me-2"></i>
                        We will send your message to <strong>stayfinder101@gmail.com</strong> and respond within 24 hours.
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="background: #f8f9fa;">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="emailForm" class="btn btn-primary" style="background: linear-gradient(135deg, #2196F3, #1976d2); border: none;">
                    <i class="bi bi-send me-2"></i>Send Email
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}
